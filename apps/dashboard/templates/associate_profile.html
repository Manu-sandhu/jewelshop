{% extends 'admin_base.html' %}
{% block title %}Associates{% endblock %}
{% load account_tags %}
{% block content %}
<section class="common_wrapper">
    <div class="content">
        <div class="col-xs-12 col-sm-8  col-md-offset-4 col-md-10 col-md-offset-2">
            <span class="page-main-title">Associate Profile</span>
        </div>
        <div class="row mainDiv" id="profile_main_container">
            <div class="col-md-12 qq-block">
                <a href="{% url 'delete_user' associate.name_slug_field %}" class="qq-delete"><i class="fa-trash"></i> </a>
                <div class="descriptnDiv" id="div1">
                    <div class="row">
                        <div class="col-md-12">
                            <a href="javascript:void(0)" id="edit" title="Edit" class="editPencil"><i
                                    class="fa fa-pencil"></i></a>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-2">
                            {% if associate.associate_acc_profile.associate_photo %}
                            <img src="{{ associate.associate_acc_profile.associate_photo.url }}"
                                 class="img-responsive profile" alt="{{ associate.get_full_name }}"/>
                            {% else %}
                            <img src="/static/images/no-name.png" alt="{{ associate.get_full_name }}"/>
                            {% endif %}
                            <!--<h4 class="text-center">{{ associate.get_full_name }}</h4>-->
                        </div>
                        <div class="col-xs-12 col-sm-8 col-md-10 padTop30">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-xs-6 col-sm-6 col-md-4">
                                        <p>Name<span class="pull-right">:</span></p>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-8">
                                        <p>{{ associate.get_full_name }}</p>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-xs-6 col-sm-6 col-md-4">
                                        <p>Username<span class="pull-right">:</span></p>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-8">
                                        <p>{{ associate.username }}</p>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-xs-6 col-sm-6 col-md-4">
                                         <p>Email<span class="pull-right">:</span></p>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-8">
                                        <p>{{ associate.email }}</p>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="descriptnDiv hide" id="div2">
                    <form role="form" action="." id="associate_update" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <a href="#" class="editBlock" id="cancel_profile_edit" title="Cancel"><i
                                        class="fa fa-ban"></i></a>
                                <a href="javascript:void(0)" id="save_profile" class="editPencil" title="Save"><i
                                        class="fa fa-floppy-o"></i></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="row">
                            <div class="col-xs-4 col-sm-4 col-md-2">
                                <div class="profile-pic">
                                    <input type="file" id="profileUpload" class="hide" name="associate_photo"/>
                                    {% if associate.associate_acc_profile.associate_photo %}
                                    <img src="{{ associate.associate_acc_profile.associate_photo.url }}"
                                         class="img-thumbnail img-responsive profile"
                                         alt="{{ associate.get_full_name }}"/>
                                    {% else %}
                                    <img src="/static/images/no-name.png" alt="{{ associate.get_full_name }}"/>
                                    {% endif %}
                                    <div class="edit"><a href="javascript:void(0)" id="btnImageUploader" title="Edit"><i
                                            class="fa fa-pencil fa-lg"></i></a></div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-8 col-md-5 padTop30">
                                <div class="form-group row">
                                    <label for="first_name" class="col-sm-2 col-md-4 form-control-label">First
                                        name</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" name="first_name" id="first_name"
                                               value="{{ associate.first_name }}" placeholder="First Name">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="user_name" class="col-sm-2 col-md-4 form-control-label">User
                                        Name</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" id="user_name" name="username"
                                               value="{{ associate.username }}" placeholder="User Name" required readonly
                                               >
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-8 col-md-5 padTop30">

                                <div class="form-group row">
                                    <label for="last_name" class="col-sm-2 col-md-4 form-control-label">Last
                                        Name</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" name="last_name" id="last_name"
                                               value="{{ associate.last_name }}" placeholder="Last Name">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="email" class="col-sm-2 col-md-4 form-control-label">Email</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="email" class="form-control" id="email" name="email"
                                               value="{{ associate.email }}" placeholder="Email" required >
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="clearfix"></div>
                    </form>
                    <p class="">Click <a herf="javascript:void(0)" class="link-text"
                                                    id="password_modal">here</a> to change password</p>
                </div>
            </div>
        </div>
        <!-- Profile Edit closes here -->
        {% if not request.user|has_group:"super admin" %}
        <div class="row mainDiv" id="settings_main_container">
            <div class="col-md-12">
                <div class="descriptnDiv" id="settings_view">
                    <div class="row">
                        <div class="col-md-12">
                            <a href="javascript:void(0)" style="float:right;" title="Edit" id="settings_edit"><i
                                    class="fa fa-pencil"></i></a>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-2"></div>
                        <div class="col-md-8">
                            <div class="row">
                                <!--<p class="boldhead"> Settings</p>-->

                                <div class="col-xs-4 col-sm-4 col-md-4">
                                    <p>Designation<span class="pull-right">:</span></p>

                                    <p>Phone number<span class="pull-right">:</span></p>

                                    <p>Address<span class="pull-right">:</span></p>

                                    <p>Zip code<span class="pull-right">:</span></p>
                                </div>
                                <div class="col-xs-8 col-sm-8 col-md-8">
                                    <p>{{ associate.associate_acc_profile.designation }}</p>

                                    <p>{{ associate.associate_acc_profile.phone }}</p>

                                    <p>{{ associate.associate_acc_profile.address }}</p>

                                    <p>{{ associate.associate_acc_profile.zip_code }}</p>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="col-md-2"></div>
                        <div class="clearfix"></div>
                    </div>

                    <div class="clearfix"></div>
                </div>

                <div class="descriptnDiv hide" id="settings_edit_holder">
                    <form role="form" action="." id="update_settings" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" id="user_id" value="{{ associate.id }}">

                        <div class="row">
                            <div class="col-md-12">
                                <a href="javascript:void(0)" class="editBlock" id="cancel_setting" title="Cancel"><i
                                        class="fa fa-ban"></i></a>
                                <a href="javascript:void(0)" id="save_settings" class="editPencil" title="Save"><i
                                        class="fa fa-floppy-o"></i></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="row">
                            <p class="text-success" id="password-success"> Password changed successfully</p>
                        </div>
                        <div class="row">
                            <div class="col-xs-4 col-sm-4 col-md-2">
                            </div>

                            <div class="col-xs-12 col-sm-8 col-md-5 padTop30">

                                <div class="form-group row">
                                    <label for="designation"
                                           class="col-sm-2 col-md-4 form-control-label">Designation</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" id="designation" name="designation"
                                               value="{{ associate.associate_acc_profile.designation }}"
                                               placeholder="Designation">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="address" class="col-sm-2 col-md-4 form-control-label">Address</label>

                                    <div class="col-sm-10 col-md-8">
                                            <textarea class="form-control" id="address" name="address"
                                                      required placeholder="Address">
                                                {{ associate.associate_acc_profile.address }}
                                            </textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-8 col-md-5 padTop30">
                                <div class="form-group row">
                                    <label for="phone_number" class="col-sm-2 col-md-4 form-control-label">Phone</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" id="phone_number" name="phone"
                                               value="{{ associate.associate_acc_profile.phone }}"
                                               required placeholder="Phone">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="zip_code" class="col-sm-2 col-md-4 form-control-label">Zip code</label>

                                    <div class="col-sm-10 col-md-8">
                                        <input type="text" class="form-control" id="zip_code" name="zip_code"
                                               value="{{ associate.associate_acc_profile.zip_code }}"
                                               placeholder="Zip code">
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </form>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <!-- settings closes here -->
    <!--Change password modal-->
    <div id="password_change" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close close-pw-modal" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Change password</h4>
                </div>
                <form action="." method="post" name="passwordChangeForm" id="passwordChangeForm">
                    <div class="modal-body">
                        <div class="form-group row">
                            <label for="id_password1" class="col-sm-2 col-md-4 form-control-label">New password</label>

                            <div class="col-sm-10 col-md-8">
                                <input type="password" name="password1" class="form-control" id="password1" required/>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="id_password2" class="col-sm-2 col-md-4 form-control-label">Confirm
                                password</label>

                            <div class="col-sm-10 col-md-8">
                                <input type="password" name="password2" class="form-control" id="password2" required/>
                            </div>
                        </div>
                        <div class="alert alert-warning hide" id="password-alert">
                            Password does not matching
                        </div>
                        <div class="row">
                            <div class="col-xs-12">

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary save_password">Change my password</button>
                        <button type="button" class="btn btn-default close-pw-modal" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
    <!--Change password modal ends-->
    </div>
</section>
{% endblock %}
{% block extra_js %}
<script>
        $( document ).ready(function() {
            $('#password-success').hide();
            // profile uploader
            $(document).on('click', '#btnImageUploader', function() {
                $('#profileUpload').click();
            });
            $(document).on('click', '#edit', function() {
                $('#div1').addClass('hide');
                $('#div2').removeClass('hide');
            });
            $(document).on('click', '#cancel_profile_edit', function() {
                $('#div1').removeClass('hide');
                $('#div2').addClass('hide');
            });
            $(document).on('click', '#settings_edit', function() {
                $('#settings_view').addClass('hide');
                $('#settings_edit_holder').removeClass('hide');
            });
            $(document).on('click', '#cancel_setting', function() {
                $('#settings_view').removeClass('hide');
                $('#settings_edit_holder').addClass('hide');
                $('#password-success').hide();
            });
            $(document).on('click', '#password_modal', function() {
                $('#password_change').modal('show');
            });
            $(document).on('click', '.close-pw-modal', function() {
                if(!($('#password-alert').hasClass('hide'))){
                    $('#password-alert').addClass('hide')
                }
                $('#password1').val("");
                $('#password2').val("");
            });
        });
        /**click function for remove item**/
        $(document).on('click', '.abc-close-icon', function() {
            $($(this).parent().parent().parent()).remove();
        });
        $(document).on("click",".cls", function(){
            var parentDiv = $(this).parent().parent().find('.collapse_menu');
            $('.collapse_menu').slideUp(400);
            if($('#swipeMenu').hasClass('active')) {
                $('#swipeMenu').removeClass('active');
            }
        });
        /*
        $(document).on('change', '#profileUpload', function() {

            if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
            	 console.log(e.target.result);
                $('.profile-pic>img')
                    .attr('src', e.target.result)
                    .width(150)
                    .height(200);
            };
            reader.readAsDataURL(input.files[0]);
            }
        });
        */

        $(document).on('click', '#save_profile', function() {

            $('.error_msg').hide()
            form_data = $('#associate_update').serialize();
            var user_id = $('#user_id').val();
            var file = $("#profileUpload")[0].files[0];
            var formData = new FormData();
            formData.append("associate_photo", file);
            formData.append("user_id", user_id);

            $.ajax({
                url : "{% url 'associate_save_edit' %}",
                type : "POST",
                data : formData,
                async: false,
                processData: false,
                contentType: false,

                // handle a successful response
                success : function(response) {
                    form_data = $('#associate_update').serialize();
                    var user_id = $('#user_id').val();
                    var profile_img = $('#profileUpload').val().split('\\').pop();
                    new_data = form_data+'&user_id='+ user_id;
                    data = new_data+'&profile='+ 'profile';
                    $.ajax({
                        url : "{% url 'associate_save_edit' %}",
                        type : "POST",
                        async: false,
                        data : data,
                        success : function(response) {
                            console.log(response);
                            if (response.status==true)
                            {
                                $.ajax({
                                    url : "{% url 'associate_save_edit' %}",
                                    type : "POST",
                                    data : formData,
                                    processData: false,
                                    contentType: false,

                                    // handle a successful response
                                    success : function(response) {
                                    console.log(response)
                                    if (response.status==true)
                                    {
                                        $.ajax({
                                            url : "{% url 'associate_profile_data' %}",
                                            type : "POST",
                                            data : { user_id, user_id },
                                            success: function(response_data){
                                                if (response_data.status==true){
                                                    console.log(response_data.html_content);
                                                    $('#profile_main_container').replaceWith(response_data.html_content);
                                                    $('#password-success').hide();
                                                }
                                                else{
                                                    console.log('error');
                                                }
                                            }
                                        });
                                    }
                                    },
                                });
                            }
                            else if (response.status==false)
                           {
                            if (response.errors.email){
                                $('#email').after("<p class='error_msg' >"+response.errors.email+"</p>")
                            }
                           }
                        },
                    });
                },
            });


        });

         $(document).on('click', '#save_settings', function() {
            if($('#phone_number').val()==null){
                alert();
            }
            form_data = $('#update_settings').serialize();
            var user_id = $('#user_id').val();
            data = form_data+'&user_id='+ user_id;
            event.preventDefault();
            $.ajax({
            url : "{% url 'associate_settings_edit' %}",
            type : "POST",
            data : data,

            // handle a successful response
            success : function(response) {
                console.log(response)

                if (response.status==true)
                {
                    $.ajax({
                        url : "{% url 'associate_profile_data' %}",
                        type : "GET",
                        data : { user_id, user_id },
                        success: function(response_data){

                            if (response_data.status==true){
                                console.log(response_data.html_content);
                                $('#settings_main_container').replaceWith(response_data.html_content);
                            }
                            else{
                               console.log('error');
                            }
                        }
                    });
                }
                else if (response.status==false)
                   {
                    console.log('error occur');
                   }
                },
            });
        });

        $(document).on('click', '.save_password', function() {
            var password1 = $('#password1').val();
            var password2 = $('#password2').val();
            if(password1 == password2){
                form_data = $('#passwordChangeForm').serialize();
                var user_id = $('#user_id').val();
                new_data = form_data+'&user_id='+ user_id;
                data = new_data+'&associate='+ 'associate';
                event.preventDefault();
                $.ajax({
                url : "{% url 'change_password' %}",
                type : "POST",
                data : data,

                // handle a successful response
                success : function(response) {
                    if (response.status==true)
                    {
                        $('#password_change').modal('hide');
                        $('#password1').val("");
                        $('#password2').val("");
                        $('#password-success').show();
                    }
                    else if (response.status==false)
                       {
                        console.log('error occur');
                       }
                    },
                });
            }
            else{
                $('#password-alert').removeClass('hide');
            }
        });



</script>

{% endblock %}